# Mario Kart World - Race Result Analyzer

## 概要 (Overview)

このアプリケーションは、PCでプレイしている「マリオカートワールド」のゲームプレイ映像をリアルタイムで監視し、レース結果を自動で記録・分析するためのツールです。キャプチャーデバイスからの映像や、特定のウィンドウ画面を監視し、リザルト画面が表示されると自動でスクリーンショットを撮影。コース名、順位、レート、参加人数などの情報を抽出し、CSVファイルに保存します。

## 主な機能 (Key Features)

  * **リアルタイム監視**: 映像デバイスまたはウィンドウを指定して、ゲーム画面をバックグラウンドで監視します。
  * **自動画面検出**: 「コース決定画面」と「リザルト画面」を自動で認識します。
  * **データ自動抽出**: OCR（光学文字認識）技術を用いて、以下の情報を画像から自動で読み取ります。
      * コース名（日本語対応、2コース連結パターンにも対応）
      * 開始前レートと参加人数
      * レース後の最終順位と最終レート
      * レートの純増減
  * **CSVロギング**: 抽出した全データをCSVファイルに時系列で記録します。
  * **統計情報表示**: アプリケーションのGUIに、合計レース数や平均レートなどの統計情報を表示します。
  * **デバッグ機能**: 監視中の状況や、画像解析の各ステップを画像として保存し、問題解決をサポートします。

## セットアップ (Setup)

### 1\. Tesseract-OCR のインストール

このアプリケーションは、文字認識のために **Tesseract-OCR** を使用します。

  * 公式インストーラー（例: `tesseract-ocr-w64-setup-v5.X.X....exe`）をダウンロードし、インストールしてください。
  * **重要**: インストール時に、「Additional language data」の項目で **"Japanese"** と **"Japanese (Vertical)"** にチェックを入れて、日本語言語パックを必ずインストールしてください。
  * インストール後、`src/app.py`内の`TESSERACT_PATH`変数が、ご自身のTesseractのインストール先（通常は `C:\Program Files\Tesseract-OCR\tesseract.exe`）を指していることを確認してください。

### 2\. Pythonライブラリのインストール

プロジェクトのルートディレクトリで、以下のコマンドを実行して必要なライブラリをインストールします。

```bash
pip install -r requirements.txt
```

## 使い方 (Usage)

1.  `src` フォルダにある `app.py` を実行します。

    ```bash
    python src/app.py
    ```

2.  初回起動時、または前回の監視ソースが見つからない場合、「監視コントロール」ウィンドウが表示されます。

3.  「監視ソース」から「映像デバイス」または「ウィンドウ」を選択し、ドロップダウンリストから対象を選択します。

4.  「監視開始」ボタンを押すと、自動で画面の監視と解析が始まります。

5.  監視を停止したい場合は、メインウィンドウの「監視停止」ボタンを押します。

## フォルダ構成 (Folder Structure)

```
mkworld-tracker/
|-- data/               # プログラムが生成するデータ
|   |-- temp/           #   └ 一時的なスクリーンショットや切り抜き画像
|   |-- output/         #   └ 最終的なCSVデータ (race_data.csv)
|   |-- debug/          #   └ デバッグモードで保存される画像
|-- src/                # ソースコード
|   |-- app.py          #   └ メインアプリ (GUI, 監視ループ)
|   |-- analysis.py     #   └ 解析ロジック
|   |-- imaging.py      #   └ 画像処理 (切り抜き、デバッグ描画)
|   |-- ocr.py          #   └ OCR関連 (文字認識、前処理)
|   |-- config.py       #   └ 座標などの設定ファイル
|-- tools/              # 補助的なデバッグツール
|-- .gitignore
|-- requirements.txt
|-- README.md
```

## 設定の調整 (Configuration)

キャプチャ環境（解像度など）によって画像認識がうまくいかない場合、**`src/config.py`** ファイル内の座標値を調整してください。デバッグ機能で出力される画像を見ながら、各`x1, y1, x2, y2`の値を微調整することで、認識精度を向上させることができます。